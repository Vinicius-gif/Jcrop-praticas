<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="dist/jcrop.css">
    <link rel="stylesheet" href="css/uplad.css">
  
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <script src="dist/jcrop.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/jcrop/dist/jcrop.css">
    <script src="https://unpkg.com/jcrop"></script>

    <title>Upload | Jcrop</title>
</head>
<body>
    <header>
        <div class="caixa">
            <nav>
                <ul class="txt-cabecalho"></ul>
                    <li><a href="main.html">Home</a></li>
                    <li><a href="upload.html">Upload</a></li>
                    <li><a href="funcoes.html">Funções</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main_upload">
        <h1 class="titulo-pirncipal">Upload de imagem</h1>

    <form class="upload-imagem">
        <input type="file" class="upload" required>
        <button>Alterar Imagem</button>
    </form>

    <div>
        <img class="imagem" id="target" src="http://via.placeholder.com/350x150" alt="Sua imagem" width="550" height="300">
    </div>

    <h2>ou direto neste botao após enviar uma imagem!!</h2>

    <div>
        <button class="btnAtualiza">Atualiza imagem</button>
    </div>

    <script>
        //IIFE Immediately Invoked Function Expression
        ;(function(){

        //Pega os elementos da tela e declara como constantes
        const leitorDeArquivos = new FileReader(),
                formulario = document.querySelector('.upload-imagem'),
                previaDaImagem = document.querySelector('.imagem'),
                inputArquivo = document.querySelector('.upload'),
                btnAtualiza = document.querySelector('.btnAtualiza');


        function leEAtualiza(){
            //pega o arquivo enviado e guarda nesta variavel
            let imagemEnviada = inputArquivo.files[0];

            //Usa a função do objeto leitor de arquivos, que lê o arquivo, e consegue reaproveita-lo para usar o arquivo como uma URL
            leitorDeArquivos.readAsDataURL(imagemEnviada);
            
            //Após leitura da imagem (evento load), a função de callback define o valor do src da imagem de prévia com o valor do resultado da leitura do leitor de arquivos
            leitorDeArquivos.addEventListener('loadend', function(load){
                
                //veja no console o que o resultado do leitor de arquivos :)
                console.log(load.target.result);
                //define o caminho da imagem com o caminho criado pelo leitor de arquivos
                previaDaImagem.src = load.target.result
            })
        }

        //Quando o formulário for enviado:
        formulario.addEventListener('submit', function(submit){
            //empede o recarregamento da página
            submit.preventDefault();

            leEAtualiza();
        })

        //Ou quando clica no boão atualizar
        btnAtualiza.addEventListener('click', function(){
            leEAtualiza();
        })

        })()

        const jcrop = Jcrop.attach('target',
        {
            shadeColor: '#8a2be2',
            shadeOpacity: 0.6,
            shadeFade: true
        })

    </script>
    </main>
    
    <footer>
        <h1 class="rodapeh1">Este é o rodapé</h1>
    </footer>
</body>
</html>